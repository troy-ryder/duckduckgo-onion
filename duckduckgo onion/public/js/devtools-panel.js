(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var _chrome$devtools, _chrome$devtools$insp;

var table = document.querySelector('#request-table');
var clearButton = document.getElementById('clear');
var refreshButton = document.getElementById('refresh');
var protectionButton = document.getElementById('protection');
var tabPicker = document.getElementById('tab-picker');
var tdsOption = document.getElementById('tds');
var displayFilters = document.querySelectorAll('#table-filter input');

function sendMessage(messageType, options, callback) {
  chrome.runtime.sendMessage({
    messageType: messageType,
    options: options
  }, callback);
}

var tabId = ((_chrome$devtools = chrome.devtools) === null || _chrome$devtools === void 0 ? void 0 : (_chrome$devtools$insp = _chrome$devtools.inspectedWindow) === null || _chrome$devtools$insp === void 0 ? void 0 : _chrome$devtools$insp.tabId) || parseInt(0 + new URL(document.location.href).searchParams.get('tabId'));
var port = chrome.runtime.connect(); // fetch the list of configurable features from the config and create toggles for them.

var loadConfigurableFeatures = new Promise(function (resolve) {
  sendMessage('getListContents', 'config', function (_ref) {
    var config = _ref.data;
    var features = Object.keys(config.features);
    features.forEach(function (feature) {
      var btn = document.createElement('button');
      btn.id = feature;
      btn.innerText = "".concat(feature, ": ???");
      document.querySelector('#protections').appendChild(btn);
      btn.addEventListener('click', function () {
        port.postMessage({
          action: "toggle".concat(feature),
          tabId: tabId
        });
      });
    });
    resolve(features);
  });
});
var actionIcons = {
  block: 'ðŸš«',
  redirect: 'âž¡ï¸',
  ignore: 'âš ï¸'
};
var actionHandlers = {
  tracker: function tracker(m) {
    var _m$message = m.message,
        tracker = _m$message.tracker,
        url = _m$message.url,
        requestData = _m$message.requestData,
        siteUrl = _m$message.siteUrl;
    var row = document.getElementById('request-row').content.firstElementChild.cloneNode(true);
    var cells = row.querySelectorAll('td');
    var toggleLink = row.querySelector('.block-toggle');
    toggleLink.href = '';

    if (tracker.action === 'block') {
      toggleLink.innerText = 'I';
    } else {
      toggleLink.innerText = 'B';
    }

    toggleLink.addEventListener('click', function (ev) {
      ev.preventDefault();
      port.postMessage({
        action: toggleLink.innerText,
        tabId: tabId,
        tracker: tracker,
        requestData: requestData,
        siteUrl: siteUrl
      });
      row.classList.remove(tracker.action);
      row.classList.add(toggleLink.innerText === 'I' ? 'ignore' : 'block');
    });
    [url, "".concat(actionIcons[tracker.action], " ").concat(tracker.action, " (").concat(tracker.reason, ")"), tracker.fullTrackerDomain, requestData.type].forEach(function (text, i) {
      cells[i + 1].innerText = text;
    });
    row.classList.add(tracker.action);
    table.appendChild(row);
  },
  tabChange: function tabChange(m) {
    var _tab$site, _tab$site2;

    var tab = m.message;
    protectionButton.innerText = "Protection: ".concat((_tab$site = tab.site) !== null && _tab$site !== void 0 && _tab$site.allowlisted || (_tab$site2 = tab.site) !== null && _tab$site2 !== void 0 && _tab$site2.isBroken ? 'OFF' : 'ON');
    loadConfigurableFeatures.then(function (features) {
      features.forEach(function (feature) {
        var _tab$site3;

        document.getElementById(feature).innerText = "".concat(feature, ": ").concat((_tab$site3 = tab.site) !== null && _tab$site3 !== void 0 && _tab$site3.enabledFeatures.includes(feature) ? 'ON' : 'OFF');
      });
    });
  },
  cookie: function cookie(m) {
    var _m$message2 = m.message,
        action = _m$message2.action,
        kind = _m$message2.kind,
        url = _m$message2.url,
        requestId = _m$message2.requestId,
        type = _m$message2.type;
    var rowId = "request-".concat(requestId);

    if (document.getElementById(rowId) !== null) {
      var row = document.getElementById(rowId);
      var cells = row.querySelectorAll('td');
      row.classList.add(kind);
      cells[3].textContent = "".concat(cells[3].textContent, ", ").concat(kind);
    } else {
      var _row = document.getElementById('cookie-row').content.firstElementChild.cloneNode(true);

      _row.id = rowId;

      var _cells = _row.querySelectorAll('td');

      var cleanUrl = new URL(url);
      cleanUrl.search = '';
      cleanUrl.hash = '';
      _cells[1].textContent = cleanUrl.href;
      _cells[2].textContent = "\uD83C\uDF6A ".concat(action);
      _cells[3].textContent = kind;
      _cells[4].textContent = type;

      _row.classList.add(kind);

      table.appendChild(_row);
    }
  },
  jscookie: function jscookie(m) {
    var _m$message3 = m.message,
        documentUrl = _m$message3.documentUrl,
        action = _m$message3.action,
        reason = _m$message3.reason,
        value = _m$message3.value,
        scriptOrigins = _m$message3.scriptOrigins;
    var row = document.getElementById('cookie-row').content.firstElementChild.cloneNode(true);
    var cells = row.querySelectorAll('td');
    cells[1].textContent = documentUrl;
    cells[2].textContent = "JS\uD83C\uDF6A ".concat(action, " (").concat(reason, ")");
    cells[3].textContent = scriptOrigins.join(',');
    cells[4].textContent = value.split(';')[0];
    row.classList.add('jscookie');
    table.appendChild(row);
  },
  fingerprintingCanvas: function fingerprintingCanvas(m) {
    var _m$message4 = m.message,
        documentUrl = _m$message4.documentUrl,
        action = _m$message4.action,
        kind = _m$message4.kind,
        stack = _m$message4.stack,
        args = _m$message4.args;
    var row = document.getElementById('cookie-row').content.firstElementChild.cloneNode(true);
    var cells = row.querySelectorAll('td');
    cells[1].textContent = documentUrl;
    cells[2].textContent = "Canvas ".concat(action);
    var argsOut = JSON.parse(args).join(', ');
    cells[3].setAttribute('colspan', 2);
    cells[4].remove();
    var lines = stack.split('\n');
    lines.shift();
    cells[3].textContent = "".concat(kind, "(").concat(argsOut, ")");
    var details = document.createElement('details');
    var summary = document.createElement('summary');
    summary.textContent = 'Call stack';
    details.appendChild(summary);
    details.appendChild(document.createTextNode(lines.join('\n')));
    cells[3].appendChild(details);
    row.classList.add('canvas');
    table.appendChild(row);
  }
};

function shouldShowRow(className) {
  var filter = document.getElementById("display-".concat(className));
  return !filter || filter.checked;
}

function setRowVisible(row) {
  row.hidden = !shouldShowRow(row.classList[0]);
}

port.onMessage.addListener(function (message) {
  var m = JSON.parse(message);

  if (m.tabId === tabId) {
    if (actionHandlers[m.action]) {
      actionHandlers[m.action](m);
    }

    if (document.querySelector('tbody').lastChild) {
      setRowVisible(document.querySelector('tbody').lastChild);
    }
  }
});

function updateTabSelector() {
  chrome.tabs.query({}, function (tabs) {
    while (tabPicker.firstChild !== null) {
      tabPicker.removeChild(tabPicker.firstChild);
    }

    var selectTabOption = document.createElement('option');
    selectTabOption.value = '';
    selectTabOption.innerText = '--Select Tab--';
    tabPicker.appendChild(selectTabOption);
    tabs.forEach(function (tab) {
      if (tab.url.startsWith('http')) {
        var elem = document.createElement('option');
        elem.value = tab.id;
        elem.innerText = tab.title;

        if (tab.id === tabId) {
          elem.setAttribute('selected', true);
        }

        tabPicker.appendChild(elem);
      }
    });
  });
}

if (!chrome.devtools) {
  updateTabSelector();
  chrome.tabs.onUpdated.addListener(updateTabSelector);
  tabPicker.addEventListener('change', function () {
    tabId = parseInt(tabPicker.selectedOptions[0].value);
    clear();
    port.postMessage({
      action: 'setTab',
      tabId: tabId
    });
  });
} else {
  tabPicker.hidden = true;
}

if (tabId) {
  port.postMessage({
    action: 'setTab',
    tabId: tabId
  });
}

function clear() {
  while (table.lastChild) {
    table.removeChild(table.lastChild);
  }
} // listeners for buttons and toggles


clearButton.addEventListener('click', clear);
refreshButton.addEventListener('click', function () {
  clear();

  if (chrome.devtools) {
    chrome.devtools.inspectedWindow.eval('window.location.reload();');
  } else {
    chrome.tabs.reload(tabId);
  }
});
protectionButton.addEventListener('click', function () {
  port.postMessage({
    action: 'toggleProtection',
    tabId: tabId
  });
});
sendMessage('getSetting', {
  name: 'tds-channel'
}, function (result) {
  console.log('setting', result);
  var active = tdsOption.querySelector("[value=".concat(result));

  if (active) {
    active.setAttribute('selected', true);
  }
});
tdsOption.addEventListener('change', function (e) {
  sendMessage('updateSetting', {
    name: 'tds-channel',
    value: tdsOption.selectedOptions[0].value
  }, function () {
    sendMessage('reloadList', 'tds');
  });
});
displayFilters.forEach(function (input) {
  input.addEventListener('change', function () {
    document.querySelectorAll('tr').forEach(setRowVisible);
  });
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzaGFyZWQvanMvZGV2dG9vbHMvcGFuZWwuZXM2LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0FBLElBQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFULENBQXVCLGdCQUF2QixDQUFkO0FBQ0EsSUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsT0FBeEIsQ0FBcEI7QUFDQSxJQUFNLGFBQWEsR0FBRyxRQUFRLENBQUMsY0FBVCxDQUF3QixTQUF4QixDQUF0QjtBQUNBLElBQU0sZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsWUFBeEIsQ0FBekI7QUFDQSxJQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsY0FBVCxDQUF3QixZQUF4QixDQUFsQjtBQUNBLElBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxjQUFULENBQXdCLEtBQXhCLENBQWxCO0FBQ0EsSUFBTSxjQUFjLEdBQUcsUUFBUSxDQUFDLGdCQUFULENBQTBCLHFCQUExQixDQUF2Qjs7QUFFQSxTQUFTLFdBQVQsQ0FBc0IsV0FBdEIsRUFBbUMsT0FBbkMsRUFBNEMsUUFBNUMsRUFBc0Q7QUFDbEQsRUFBQSxNQUFNLENBQUMsT0FBUCxDQUFlLFdBQWYsQ0FBMkI7QUFBRSxJQUFBLFdBQVcsRUFBWCxXQUFGO0FBQWUsSUFBQSxPQUFPLEVBQVA7QUFBZixHQUEzQixFQUFxRCxRQUFyRDtBQUNIOztBQUVELElBQUksS0FBSyxHQUFHLHFCQUFBLE1BQU0sQ0FBQyxRQUFQLCtGQUFpQixlQUFqQixnRkFBa0MsS0FBbEMsS0FBMkMsUUFBUSxDQUFDLElBQUksSUFBSSxHQUFKLENBQVEsUUFBUSxDQUFDLFFBQVQsQ0FBa0IsSUFBMUIsRUFBZ0MsWUFBaEMsQ0FBNkMsR0FBN0MsQ0FBaUQsT0FBakQsQ0FBTCxDQUEvRDtBQUNBLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxPQUFQLENBQWUsT0FB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dCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgdGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVxdWVzdC10YWJsZScpXG5jb25zdCBjbGVhckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhcicpXG5jb25zdCByZWZyZXNoQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZnJlc2gnKVxuY29uc3QgcHJvdGVjdGlvbkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm90ZWN0aW9uJylcbmNvbnN0IHRhYlBpY2tlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWItcGlja2VyJylcbmNvbnN0IHRkc09wdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZHMnKVxuY29uc3QgZGlzcGxheUZpbHRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjdGFibGUtZmlsdGVyIGlucHV0JylcblxuZnVuY3Rpb24gc2VuZE1lc3NhZ2UgKG1lc3NhZ2VUeXBlLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHsgbWVzc2FnZVR5cGUsIG9wdGlvbnMgfSwgY2FsbGJhY2spXG59XG5cbmxldCB0YWJJZCA9IGNocm9tZS5kZXZ0b29scz8uaW5zcGVjdGVkV2luZG93Py50YWJJZCB8fCBwYXJzZUludCgwICsgbmV3IFVSTChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKS5zZWFyY2hQYXJhbXMuZ2V0KCd0YWJJZCcpKVxuY29uc3QgcG9ydCA9IGNocm9tZS5ydW50aW1lLmNvbm5lY3QoKVxuLy8gZmV0Y2ggdGhlIGxpc3Qgb2YgY29uZmlndXJhYmxlIGZlYXR1cmVzIGZyb20gdGhlIGNvbmZpZyBhbmQgY3JlYXRlIHRvZ2dsZXMgZm9yIHRoZW0uXG5jb25zdCBsb2FkQ29uZmlndXJhYmxlRmVhdHVyZXMgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIHNlbmRNZXNzYWdlKCdnZXRMaXN0Q29udGVudHMnLCAnY29uZmlnJywgKHsgZGF0YTogY29uZmlnIH0pID0+IHtcbiAgICAgICAgY29uc3QgZmVhdHVyZXMgPSBPYmplY3Qua2V5cyhjb25maWcuZmVhdHVyZXMpXG4gICAgICAgIGZlYXR1cmVzLmZvckVhY2goKGZlYXR1cmUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgICAgICAgICBidG4uaWQgPSBmZWF0dXJlXG4gICAgICAgICAgICBidG4uaW5uZXJUZXh0ID0gYCR7ZmVhdHVyZX06ID8/P2BcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm90ZWN0aW9ucycpLmFwcGVuZENoaWxkKGJ0bilcbiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBwb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBgdG9nZ2xlJHtmZWF0dXJlfWAsXG4gICAgICAgICAgICAgICAgICAgIHRhYklkXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICAgIHJlc29sdmUoZmVhdHVyZXMpXG4gICAgfSlcbn0pXG5cbmNvbnN0IGFjdGlvbkljb25zID0ge1xuICAgIGJsb2NrOiAn8J+aqycsXG4gICAgcmVkaXJlY3Q6ICfinqHvuI8nLFxuICAgIGlnbm9yZTogJ+KaoO+4jydcbn1cblxuY29uc3QgYWN0aW9uSGFuZGxlcnMgPSB7XG4gICAgdHJhY2tlcjogKG0pID0+IHtcbiAgICAgICAgY29uc3QgeyB0cmFja2VyLCB1cmwsIHJlcXVlc3REYXRhLCBzaXRlVXJsIH0gPSBtLm1lc3NhZ2VcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcXVlc3Qtcm93JykuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZC5jbG9uZU5vZGUodHJ1ZSlcbiAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKVxuICAgICAgICBjb25zdCB0b2dnbGVMaW5rID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay10b2dnbGUnKVxuICAgICAgICB0b2dnbGVMaW5rLmhyZWYgPSAnJ1xuICAgICAgICBpZiAodHJhY2tlci5hY3Rpb24gPT09ICdibG9jaycpIHtcbiAgICAgICAgICAgIHRvZ2dsZUxpbmsuaW5uZXJUZXh0ID0gJ0knXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0b2dnbGVMaW5rLmlubmVyVGV4dCA9ICdCJ1xuICAgICAgICB9XG4gICAgICAgIHRvZ2dsZUxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXYpID0+IHtcbiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgIHBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogdG9nZ2xlTGluay5pbm5lclRleHQsXG4gICAgICAgICAgICAgICAgdGFiSWQsXG4gICAgICAgICAgICAgICAgdHJhY2tlcixcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YSxcbiAgICAgICAgICAgICAgICBzaXRlVXJsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcm93LmNsYXNzTGlzdC5yZW1vdmUodHJhY2tlci5hY3Rpb24pXG4gICAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCh0b2dnbGVMaW5rLmlubmVyVGV4dCA9PT0gJ0knID8gJ2lnbm9yZScgOiAnYmxvY2snKVxuICAgICAgICB9KTtcbiAgICAgICAgW3VybCwgYCR7YWN0aW9uSWNvbnNbdHJhY2tlci5hY3Rpb25dfSAke3RyYWNrZXIuYWN0aW9ufSAoJHt0cmFja2VyLnJlYXNvbn0pYCwgdHJhY2tlci5mdWxsVHJhY2tlckRvbWFpbiwgcmVxdWVzdERhdGEudHlwZV0uZm9yRWFjaCgodGV4dCwgaSkgPT4ge1xuICAgICAgICAgICAgY2VsbHNbaSArIDFdLmlubmVyVGV4dCA9IHRleHRcbiAgICAgICAgfSlcbiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQodHJhY2tlci5hY3Rpb24pXG4gICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdylcbiAgICB9LFxuICAgIHRhYkNoYW5nZTogKG0pID0+IHtcbiAgICAgICAgY29uc3QgdGFiID0gbS5tZXNzYWdlXG4gICAgICAgIHByb3RlY3Rpb25CdXR0b24uaW5uZXJUZXh0ID0gYFByb3RlY3Rpb246ICR7dGFiLnNpdGU/LmFsbG93bGlzdGVkIHx8IHRhYi5zaXRlPy5pc0Jyb2tlbiA/ICdPRkYnIDogJ09OJ31gXG4gICAgICAgIGxvYWRDb25maWd1cmFibGVGZWF0dXJlcy50aGVuKChmZWF0dXJlcykgPT4ge1xuICAgICAgICAgICAgZmVhdHVyZXMuZm9yRWFjaCgoZmVhdHVyZSkgPT4ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZlYXR1cmUpLmlubmVyVGV4dCA9IGAke2ZlYXR1cmV9OiAke3RhYi5zaXRlPy5lbmFibGVkRmVhdHVyZXMuaW5jbHVkZXMoZmVhdHVyZSkgPyAnT04nIDogJ09GRid9YFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIGNvb2tpZTogKG0pID0+IHtcbiAgICAgICAgY29uc3QgeyBhY3Rpb24sIGtpbmQsIHVybCwgcmVxdWVzdElkLCB0eXBlIH0gPSBtLm1lc3NhZ2VcbiAgICAgICAgY29uc3Qgcm93SWQgPSBgcmVxdWVzdC0ke3JlcXVlc3RJZH1gXG4gICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyb3dJZCkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvd0lkKVxuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKVxuICAgICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoa2luZClcbiAgICAgICAgICAgIGNlbGxzWzNdLnRleHRDb250ZW50ID0gYCR7Y2VsbHNbM10udGV4dENvbnRlbnR9LCAke2tpbmR9YFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvb2tpZS1yb3cnKS5jb250ZW50LmZpcnN0RWxlbWVudENoaWxkLmNsb25lTm9kZSh0cnVlKVxuICAgICAgICAgICAgcm93LmlkID0gcm93SWRcbiAgICAgICAgICAgIGNvbnN0IGNlbGxzID0gcm93LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJylcbiAgICAgICAgICAgIGNvbnN0IGNsZWFuVXJsID0gbmV3IFVSTCh1cmwpXG4gICAgICAgICAgICBjbGVhblVybC5zZWFyY2ggPSAnJ1xuICAgICAgICAgICAgY2xlYW5VcmwuaGFzaCA9ICcnXG4gICAgICAgICAgICBjZWxsc1sxXS50ZXh0Q29udGVudCA9IGNsZWFuVXJsLmhyZWZcbiAgICAgICAgICAgIGNlbGxzWzJdLnRleHRDb250ZW50ID0gYPCfjaogJHthY3Rpb259YFxuICAgICAgICAgICAgY2VsbHNbM10udGV4dENvbnRlbnQgPSBraW5kXG4gICAgICAgICAgICBjZWxsc1s0XS50ZXh0Q29udGVudCA9IHR5cGVcbiAgICAgICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKGtpbmQpXG4gICAgICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChyb3cpXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGpzY29va2llOiAobSkgPT4ge1xuICAgICAgICBjb25zdCB7IGRvY3VtZW50VXJsLCBhY3Rpb24sIHJlYXNvbiwgdmFsdWUsIHNjcmlwdE9yaWdpbnMgfSA9IG0ubWVzc2FnZVxuICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29va2llLXJvdycpLmNvbnRlbnQuZmlyc3RFbGVtZW50Q2hpbGQuY2xvbmVOb2RlKHRydWUpXG4gICAgICAgIGNvbnN0IGNlbGxzID0gcm93LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkJylcbiAgICAgICAgY2VsbHNbMV0udGV4dENvbnRlbnQgPSBkb2N1bWVudFVybFxuICAgICAgICBjZWxsc1syXS50ZXh0Q29udGVudCA9IGBKU/CfjaogJHthY3Rpb259ICgke3JlYXNvbn0pYFxuICAgICAgICBjZWxsc1szXS50ZXh0Q29udGVudCA9IHNjcmlwdE9yaWdpbnMuam9pbignLCcpXG4gICAgICAgIGNlbGxzWzRdLnRleHRDb250ZW50ID0gdmFsdWUuc3BsaXQoJzsnKVswXVxuICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgnanNjb29raWUnKVxuICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChyb3cpXG4gICAgfSxcbiAgICBmaW5nZXJwcmludGluZ0NhbnZhczogKG0pID0+IHtcbiAgICAgICAgY29uc3QgeyBkb2N1bWVudFVybCwgYWN0aW9uLCBraW5kLCBzdGFjaywgYXJncyB9ID0gbS5tZXNzYWdlXG4gICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb29raWUtcm93JykuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZC5jbG9uZU5vZGUodHJ1ZSlcbiAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKVxuICAgICAgICBjZWxsc1sxXS50ZXh0Q29udGVudCA9IGRvY3VtZW50VXJsXG4gICAgICAgIGNlbGxzWzJdLnRleHRDb250ZW50ID0gYENhbnZhcyAke2FjdGlvbn1gXG4gICAgICAgIGNvbnN0IGFyZ3NPdXQgPSBKU09OLnBhcnNlKGFyZ3MpLmpvaW4oJywgJylcbiAgICAgICAgY2VsbHNbM10uc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgMilcbiAgICAgICAgY2VsbHNbNF0ucmVtb3ZlKClcbiAgICAgICAgY29uc3QgbGluZXMgPSBzdGFjay5zcGxpdCgnXFxuJylcbiAgICAgICAgbGluZXMuc2hpZnQoKVxuXG4gICAgICAgIGNlbGxzWzNdLnRleHRDb250ZW50ID0gYCR7a2luZH0oJHthcmdzT3V0fSlgXG4gICAgICAgIGNvbnN0IGRldGFpbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkZXRhaWxzJylcbiAgICAgICAgY29uc3Qgc3VtbWFyeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N1bW1hcnknKVxuICAgICAgICBzdW1tYXJ5LnRleHRDb250ZW50ID0gJ0NhbGwgc3RhY2snXG4gICAgICAgIGRldGFpbHMuYXBwZW5kQ2hpbGQoc3VtbWFyeSlcbiAgICAgICAgZGV0YWlscy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsaW5lcy5qb2luKCdcXG4nKSkpXG4gICAgICAgIGNlbGxzWzNdLmFwcGVuZENoaWxkKGRldGFpbHMpXG5cbiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NhbnZhcycpXG4gICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdylcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNob3VsZFNob3dSb3cgKGNsYXNzTmFtZSkge1xuICAgIGNvbnN0IGZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBkaXNwbGF5LSR7Y2xhc3NOYW1lfWApXG4gICAgcmV0dXJuICFmaWx0ZXIgfHwgZmlsdGVyLmNoZWNrZWRcbn1cblxuZnVuY3Rpb24gc2V0Um93VmlzaWJsZSAocm93KSB7XG4gICAgcm93LmhpZGRlbiA9ICFzaG91bGRTaG93Um93KHJvdy5jbGFzc0xpc3RbMF0pXG59XG5cbnBvcnQub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgbSA9IEpTT04ucGFyc2UobWVzc2FnZSlcbiAgICBpZiAobS50YWJJZCA9PT0gdGFiSWQpIHtcbiAgICAgICAgaWYgKGFjdGlvbkhhbmRsZXJzW20uYWN0aW9uXSkge1xuICAgICAgICAgICAgYWN0aW9uSGFuZGxlcnNbbS5hY3Rpb25dKG0pXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5JykubGFzdENoaWxkKSB7XG4gICAgICAgICAgICBzZXRSb3dWaXNpYmxlKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5JykubGFzdENoaWxkKVxuICAgICAgICB9XG4gICAgfVxufSlcblxuZnVuY3Rpb24gdXBkYXRlVGFiU2VsZWN0b3IgKCkge1xuICAgIGNocm9tZS50YWJzLnF1ZXJ5KHt9LCAodGFicykgPT4ge1xuICAgICAgICB3aGlsZSAodGFiUGlja2VyLmZpcnN0Q2hpbGQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRhYlBpY2tlci5yZW1vdmVDaGlsZCh0YWJQaWNrZXIuZmlyc3RDaGlsZClcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZWxlY3RUYWJPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKVxuICAgICAgICBzZWxlY3RUYWJPcHRpb24udmFsdWUgPSAnJ1xuICAgICAgICBzZWxlY3RUYWJPcHRpb24uaW5uZXJUZXh0ID0gJy0tU2VsZWN0IFRhYi0tJ1xuICAgICAgICB0YWJQaWNrZXIuYXBwZW5kQ2hpbGQoc2VsZWN0VGFiT3B0aW9uKVxuICAgICAgICB0YWJzLmZvckVhY2goKHRhYikgPT4ge1xuICAgICAgICAgICAgaWYgKHRhYi51cmwuc3RhcnRzV2l0aCgnaHR0cCcpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpXG4gICAgICAgICAgICAgICAgZWxlbS52YWx1ZSA9IHRhYi5pZFxuICAgICAgICAgICAgICAgIGVsZW0uaW5uZXJUZXh0ID0gdGFiLnRpdGxlXG4gICAgICAgICAgICAgICAgaWYgKHRhYi5pZCA9PT0gdGFiSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ3NlbGVjdGVkJywgdHJ1ZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFiUGlja2VyLmFwcGVuZENoaWxkKGVsZW0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSlcbn1cblxuaWYgKCFjaHJvbWUuZGV2dG9vbHMpIHtcbiAgICB1cGRhdGVUYWJTZWxlY3RvcigpXG4gICAgY2hyb21lLnRhYnMub25VcGRhdGVkLmFkZExpc3RlbmVyKHVwZGF0ZVRhYlNlbGVjdG9yKVxuICAgIHRhYlBpY2tlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIHRhYklkID0gcGFyc2VJbnQodGFiUGlja2VyLnNlbGVjdGVkT3B0aW9uc1swXS52YWx1ZSlcbiAgICAgICAgY2xlYXIoKVxuICAgICAgICBwb3J0LnBvc3RNZXNzYWdlKHsgYWN0aW9uOiAnc2V0VGFiJywgdGFiSWQgfSlcbiAgICB9KVxufSBlbHNlIHtcbiAgICB0YWJQaWNrZXIuaGlkZGVuID0gdHJ1ZVxufVxuXG5pZiAodGFiSWQpIHtcbiAgICBwb3J0LnBvc3RNZXNzYWdlKHsgYWN0aW9uOiAnc2V0VGFiJywgdGFiSWQgfSlcbn1cblxuZnVuY3Rpb24gY2xlYXIgKCkge1xuICAgIHdoaWxlICh0YWJsZS5sYXN0Q2hpbGQpIHtcbiAgICAgICAgdGFibGUucmVtb3ZlQ2hpbGQodGFibGUubGFzdENoaWxkKVxuICAgIH1cbn1cblxuLy8gbGlzdGVuZXJzIGZvciBidXR0b25zIGFuZCB0b2dnbGVzXG5jbGVhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFyKVxucmVmcmVzaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjbGVhcigpXG4gICAgaWYgKGNocm9tZS5kZXZ0b29scykge1xuICAgICAgICBjaHJvbWUuZGV2dG9vbHMuaW5zcGVjdGVkV2luZG93LmV2YWwoJ3dpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsnKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNocm9tZS50YWJzLnJlbG9hZCh0YWJJZClcbiAgICB9XG59KVxucHJvdGVjdGlvbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBwb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgYWN0aW9uOiAndG9nZ2xlUHJvdGVjdGlvbicsXG4gICAgICAgIHRhYklkXG4gICAgfSlcbn0pXG5cbnNlbmRNZXNzYWdlKCdnZXRTZXR0aW5nJywgeyBuYW1lOiAndGRzLWNoYW5uZWwnIH0sIChyZXN1bHQpID0+IHtcbiAgICBjb25zb2xlLmxvZygnc2V0dGluZycsIHJlc3VsdClcbiAgICBjb25zdCBhY3RpdmUgPSB0ZHNPcHRpb24ucXVlcnlTZWxlY3RvcihgW3ZhbHVlPSR7cmVzdWx0fWApXG4gICAgaWYgKGFjdGl2ZSkge1xuICAgICAgICBhY3RpdmUuc2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsIHRydWUpXG4gICAgfVxufSlcblxudGRzT3B0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgc2VuZE1lc3NhZ2UoJ3VwZGF0ZVNldHRpbmcnLCB7XG4gICAgICAgIG5hbWU6ICd0ZHMtY2hhbm5lbCcsXG4gICAgICAgIHZhbHVlOiB0ZHNPcHRpb24uc2VsZWN0ZWRPcHRpb25zWzBdLnZhbHVlXG4gICAgfSwgKCkgPT4ge1xuICAgICAgICBzZW5kTWVzc2FnZSgncmVsb2FkTGlzdCcsICd0ZHMnKVxuICAgIH0pXG59KVxuXG5kaXNwbGF5RmlsdGVycy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgndHInKS5mb3JFYWNoKHNldFJvd1Zpc2libGUpXG4gICAgfSlcbn0pXG4iXX0=
